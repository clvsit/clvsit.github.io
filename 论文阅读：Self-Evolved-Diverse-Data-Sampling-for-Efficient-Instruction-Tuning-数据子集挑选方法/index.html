<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>论文阅读：Self-Evolved Diverse Data Sampling for Efficient Instruction Tuning 数据子集挑选方法 | clvsit 个人博客</title><meta name="author" content="clvsit"><meta name="copyright" content="clvsit"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="论文链接：https:&#x2F;&#x2F;arxiv.org&#x2F;abs&#x2F;2202.06417 GitHub 仓库：https:&#x2F;&#x2F;github.com&#x2F;OFA-Sys&#x2F;DiverseEvol 提高大型语言模型（LLM）的指令遵循能力主要需要大量的指令调整数据集。然而，这些数据集的庞大数量带来了相当大的计算负担和标注成本。为了研究一种标注效率高的指令调整方法，使模型本身能够主动采样同样有效甚至更有效的子集，作者引入了">
<meta property="og:type" content="article">
<meta property="og:title" content="论文阅读：Self-Evolved Diverse Data Sampling for Efficient Instruction Tuning 数据子集挑选方法">
<meta property="og:url" content="https://clvsit.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASelf-Evolved-Diverse-Data-Sampling-for-Efficient-Instruction-Tuning-%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86%E6%8C%91%E9%80%89%E6%96%B9%E6%B3%95/">
<meta property="og:site_name" content="clvsit 个人博客">
<meta property="og:description" content="论文链接：https:&#x2F;&#x2F;arxiv.org&#x2F;abs&#x2F;2202.06417 GitHub 仓库：https:&#x2F;&#x2F;github.com&#x2F;OFA-Sys&#x2F;DiverseEvol 提高大型语言模型（LLM）的指令遵循能力主要需要大量的指令调整数据集。然而，这些数据集的庞大数量带来了相当大的计算负担和标注成本。为了研究一种标注效率高的指令调整方法，使模型本身能够主动采样同样有效甚至更有效的子集，作者引入了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/Self-Evolved%20Diverse%20Data%20Sampling%20for%20Efficient%20Instruction%20Tuning/Figure%201.png">
<meta property="article:published_time" content="2024-05-12T15:31:34.000Z">
<meta property="article:modified_time" content="2024-06-27T13:41:30.126Z">
<meta property="article:author" content="clvsit">
<meta property="article:tag" content="论文阅读">
<meta property="article:tag" content="数据子集挑选">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/Self-Evolved%20Diverse%20Data%20Sampling%20for%20Efficient%20Instruction%20Tuning/Figure%201.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://clvsit.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASelf-Evolved-Diverse-Data-Sampling-for-Efficient-Instruction-Tuning-%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86%E6%8C%91%E9%80%89%E6%96%B9%E6%B3%95/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '论文阅读：Self-Evolved Diverse Data Sampling for Efficient Instruction Tuning 数据子集挑选方法',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-27 21:41:30'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">63</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/Self-Evolved%20Diverse%20Data%20Sampling%20for%20Efficient%20Instruction%20Tuning/Figure%201.png')"><nav id="nav"><span id="blog-info"><a href="/" title="clvsit 个人博客"><span class="site-name">clvsit 个人博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">论文阅读：Self-Evolved Diverse Data Sampling for Efficient Instruction Tuning 数据子集挑选方法</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-12T15:31:34.000Z" title="发表于 2024-05-12 23:31:34">2024-05-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-27T13:41:30.126Z" title="更新于 2024-06-27 21:41:30">2024-06-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/LLM/">LLM</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/LLM/%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA/">数据增强</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/LLM/%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA/%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86%E6%8C%91%E9%80%89/">数据子集挑选</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>7分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="论文阅读：Self-Evolved Diverse Data Sampling for Efficient Instruction Tuning 数据子集挑选方法"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>论文链接：<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2202.06417">https://arxiv.org/abs/2202.06417</a></p>
<p>GitHub 仓库：<a target="_blank" rel="noopener" href="https://github.com/OFA-Sys/DiverseEvol">https://github.com/OFA-Sys/DiverseEvol</a></p>
<p>提高大型语言模型（LLM）的指令遵循能力主要需要大量的指令调整数据集。然而，这些数据集的庞大数量带来了相当大的计算负担和标注成本。为了研究<strong>一种标注效率高的指令调整方法，使模型本身能够主动采样同样有效甚至更有效的子集，作者引入了一种自进化机制 DIVERSEEVOL</strong>。在这一过程中，<strong>模型会反复增强其训练子集，以完善自身性能，而无需人类或更高级 LLM 的干预</strong>。<strong>该数据采样技术的关键在于提高所选子集的多样性，因为模型会根据其当前的嵌入空间选择与任何现有数据点最不同的新数据点</strong>。三个数据集和基准的广泛实验证明了 DIVERSEEVOL 的有效性。与在全部数据上进行微调相比，在不到 8% 的原始数据集上训练的模型保持或提高了性能。作者还提供了经验证据来分析指令数据多样性的重要性，以及迭代方案相对于一次性采样的重要性。</p>
<h1 id="方法：DIVERSEEVOL"><a href="#方法：DIVERSEEVOL" class="headerlink" title="方法：DIVERSEEVOL"></a>方法：DIVERSEEVOL</h1><h2 id="迭代指令数据选择"><a href="#迭代指令数据选择" class="headerlink" title="迭代指令数据选择"></a>迭代指令数据选择</h2><p>目标是将指令数据挖掘正规化，使其成为一个迭代过程，按照一定的策略从庞大的源指令数据集中逐步提取指令。给定一个指令响应对集合，表示为 $Z &#x3D; {(x_i, y_i)}_{i \in N}$ ，其中每个 (xi, yi) 代表一个特定的指令响应对，定义 $N &#x3D; {1, \ldots, n}$ 为初始源代码指令数据集的大小。</p>
<p>迭代过程围绕两个数据容器展开：截至迭代步骤 t 的训练数据池 $P_t$ 和未选择数据点容器 $Q_t$。在每次迭代 t 中，选择函数（即策略）A 决定将哪些数据点 $S &#x3D; {s_j}<em>{j \in K}, \ K &#x3D; {1, \ldots , k}$，被整合到下一步的训练数据池 $P</em>{t+1}$中。扩大后的模型库将作为下一次模型迭代 $M_{t+1}$ 的训练集。</p>
<p>从随机数据池 $P_0$ 开始训练初始模型 $M_0$，之后的每一步都利用模型$M_t$、当前训练池$P_t$和综合数据集 Z 为函数 A 提供信息，然后函数 A 输出新的数据点$S_t$，将其添加到下一次迭代$P_{t+1}$的训练池中，如下所示：$S_t &#x3D; A(Z, P_t, M_t); P_{t + 1} &#x3D; P_t \cup S_t$。因此，每次迭代包括两个操作：</p>
<ol>
<li>根据之前训练好的模型$M_t$，提取新的数据点$S_t$并入$P_{t+1}$。</li>
<li>使用更新后的数据池$P_{t+1}$训练后续的聊天模型$M_{t+1}$。</li>
</ol>
<p>这种方法的有效性取决于选择函数 A，它决定了每次训练迭代的额外k 个数据点。随着P 数量的增加，尤其是多样性的增加（目前主流的数据子集选择算法都会采用 k-center sampling 算法），由此产生的聊天模型会不断完善其能力。</p>
<h2 id="选择算法：K-Center-Sampling"><a href="#选择算法：K-Center-Sampling" class="headerlink" title="选择算法：K-Center-Sampling"></a>选择算法：K-Center-Sampling</h2><p>DIVERSEEVOL 的核心是基于 K-Center-Sampling 的选择函数 A，详见图 1。所选子集必须能恰当地代表更广泛的数据集，以确保在缩小的子集上训练出来的模型能与在完整数据集上训练出来的模型相媲美。因此，函数 A 致力于积累一个高度多样化的源数据集子集。</p>
<p><img src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/Self-Evolved%20Diverse%20Data%20Sampling%20for%20Efficient%20Instruction%20Tuning/Figure%201.png"></p>
<blockquote>
<p>图 1：迭代 DIVERSEEVOL 概述：从初始训练数据集 P0 和源数据集的剩余数据 Q0 开始，训练一个聊天模型 M0，并将所有数据点投射到其嵌入空间 EM B0 中。在此嵌入空间中利用基于 K-Center 的选择，从 Q0 中选择一组新的数据点 S0 并添加到下一个训练数据池 P1 中，以对下一个聊天模型 M1 进行调试。此过程重复 T 步，仅根据模型本身产生逐步增强的训练数据池，然后用于改进功能更完善的模型。</p>
</blockquote>
<p>对于一组给定的训练数据点 $P_t$，函数 A 可识别出新的数据点 $S_t$，这些数据点与 $P_t$ 结合后，可提供源数据集的代表性样本。这就需要选择尽可能不同于任何现有数据点的新添加数据。与现有数据点之间的“差异”是由候选数据点（即 $Q_t$ 中尚未选定的数据点）与 $P_t$ 中任何现有训练数据的最近距离来量化的，换句话说，就是与其最近相邻数据点 $P_t$ 的距离：</p>
<p><strong>目标</strong>：从候选数据池中选择 k 个数据点，使其与各自最近的现有训练数据点的距离最大化。</p>
<p>$$<br>max \sum_{i \leq i \leq k} min_{j \in P_t} \Delta(s_i, P_j) \tag{1}<br>$$</p>
<p>函数旨在将每个已知数据点指定为整个训练池中的唯一中心。因此，它寻求 $S_t$ 中的每个新数据点与 $P_t$ 中的任何现有训练数据点之间的最小距离最大化：</p>
<p>$$<br>arg \ max_{i \in Q_t} \ min_{j \in P_t} \Delta(s_i, P_j) \tag{2}<br>$$</p>
<p>由于样本间的距离（用 ∆ 表示）是根据对所有 token 位置进行平均池化后 $M_t$ 的输出隐藏状态计算得出的，这为现有数据提供了一个更合适的嵌入空间，因此当前训练模型 $M_t$ 产生的嵌入为我们的选择提供了指导。因此，根据模型当前的理解，添加到训练集的数据点确保对现有数据集进行最佳补充。这种迭代过程有利于模型的演化，因为它可以吸收之前迭代的经验来完善其性能。</p>
<h3 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h3><p>K-Center Sampling 问题是一个 NP 难问题，但有很多 heuristic 算法可以用来近似求解。下面是一个简单的 Python 实现，使用了简单随机初始化和 K-Means 算法的迭代过程来寻找近似解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">k_center_points</span>(<span class="params">points, k</span>):</span><br><span class="line">    <span class="comment"># 随机初始化k个中心点</span></span><br><span class="line">    centers = random.sample(points, k)</span><br><span class="line">    last_centers = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 迭代更新中心点直到稳定</span></span><br><span class="line">    <span class="keyword">while</span> centers != last_centers:</span><br><span class="line">        clusters = &#123;center: [] <span class="keyword">for</span> center <span class="keyword">in</span> centers&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> points:</span><br><span class="line">            closest_center = <span class="built_in">min</span>(centers, key=<span class="keyword">lambda</span> c: <span class="built_in">sum</span>((c - point) ** <span class="number">2</span>))</span><br><span class="line">            clusters[closest_center].append(point)</span><br><span class="line">        </span><br><span class="line">        last_centers = centers</span><br><span class="line">        centers = &#123;center: <span class="built_in">sum</span>(cluster, []) // <span class="built_in">len</span>(cluster) <span class="keyword">for</span> center, cluster <span class="keyword">in</span> clusters.items()&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> centers</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 示例使用</span></span><br><span class="line">points = [(<span class="number">1</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">5</span>, <span class="number">6</span>), (<span class="number">7</span>, <span class="number">8</span>), (<span class="number">2</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">5</span>), (<span class="number">6</span>, <span class="number">7</span>), (<span class="number">8</span>, <span class="number">9</span>)]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">center_points = k_center_points(points, k)</span><br><span class="line"><span class="built_in">print</span>(center_points)</span><br></pre></td></tr></table></figure>
<p>上述代码首先随机选择 K 个点作为初始中心，然后通过迭代将每个点分配到最近的中心类别，并更新中心点位置。当中心点不再变化时，停止迭代。这个算法可以作为 K-Center Sampling 问题的一个快速近似解。</p>
<h1 id="总结与限制"><a href="#总结与限制" class="headerlink" title="总结与限制"></a>总结与限制</h1><p>引入了 DIVERSEEVOL，这是一种用于高效调整 LLM 指令的自进化方法。DIVERSEEVOL 依靠迭代方案，利用 K-Center 策略从大量指令数据中选择不同的子集，从而逐步完善自身，而无需寻求任何外部监督。经验结果表明，该方法只用了不到原始数据大小的 8%，就能达到或超过强大的基准性能。未来的工作可以在更大的指令数据集上利用该方法，以获得可能更加精细的结果。在 DIVERSEEVOL 所奠定的基础上，更先进的多样化采样算法也有望进一步提高模型性能。</p>
<p><strong>限制</strong>：DIVERSEEVOL 中的 K-Center-Sampling 方法需要计算数据点高维嵌入之间的距离。如果源数据集的规模进一步增大，这种计算可能会对 GPU 内存造成相当大的消耗。此外，评估结果在很大程度上依赖于 GPT4-judge。尽管试图通过将查询温度设置为 0 来获得更确定的结果，并通过在交替位置上进行两次模型响应查询来解决位置偏差问题，但评估过程仍可能受到 GPT4 模型内部固有偏差的影响。</p>
<h1 id="附录-A：GPT-4-Judge-模板"><a href="#附录-A：GPT-4-Judge-模板" class="headerlink" title="附录 A：GPT-4 Judge 模板"></a>附录 A：GPT-4 Judge 模板</h1><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Question]</span><br><span class="line">&#123;instruction&#125;</span><br><span class="line"></span><br><span class="line">[The Start of Assistant 1&#x27;s Answer]</span><br><span class="line">&#123;answer-of-chatbot1&#125;</span><br><span class="line">[The End of Assistant 1&#x27;s Answer]</span><br><span class="line"></span><br><span class="line">[The Start of Assistant 2&#x27;s Answer]</span><br><span class="line">&#123;answer-of-chatbot2&#125;</span><br><span class="line">[The End of Assistant 2&#x27;s Answer]</span><br><span class="line"></span><br><span class="line">[System]</span><br><span class="line">We would like to request your feedback on the performance of two AI assistants in response to the user question displayed above. Please rate the helpfulness, relevance, accuracy, level of details of their responses. Each assistant receives an overall score on a scale of 1 to 10, where a higher score indicates better overall performance. Please first output a single line containing only two values indicating the scores for Assistant 1 and 2, respectively. The two scores are separated by a space. In the subsequent line, please provide a comprehensive explanation of your evaluation, avoiding any potential bias and ensuring that the order in which the responses were presented does not affect your judgment.</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://clvsit.github.io">clvsit</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://clvsit.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASelf-Evolved-Diverse-Data-Sampling-for-Efficient-Instruction-Tuning-%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86%E6%8C%91%E9%80%89%E6%96%B9%E6%B3%95/">https://clvsit.github.io/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASelf-Evolved-Diverse-Data-Sampling-for-Efficient-Instruction-Tuning-%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86%E6%8C%91%E9%80%89%E6%96%B9%E6%B3%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://clvsit.github.io" target="_blank">clvsit 个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">论文阅读</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%AD%90%E9%9B%86%E6%8C%91%E9%80%89/">数据子集挑选</a></div><div class="post_share"><div class="social-share" data-image="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/Self-Evolved%20Diverse%20Data%20Sampling%20for%20Efficient%20Instruction%20Tuning/Figure%201.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/AI-%E6%83%85%E6%84%9F%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%B7%A5%E4%BD%9C%E4%B9%8B%E6%97%85-%E2%80%94%E2%80%94-%E4%B8%8E%E5%A4%8D%E8%AF%BB%E6%9C%BA%E9%97%AE%E9%A2%98%E7%9A%84%E7%9B%B8%E9%81%87%E4%B8%8E%E5%88%AB%E7%A6%BB/" title="AI 情感聊天机器人工作之旅 —— 与复读机问题的相遇与别离"><img class="cover" src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/task/%E5%A4%8D%E8%AF%BB%E6%9C%BA%E9%97%AE%E9%A2%98/%E5%A4%8D%E8%AF%BB%E6%9C%BA%E9%97%AE%E9%A2%98%E7%9A%84%E5%8E%9F%E5%9B%A0%E4%B8%8E%E8%A7%A3%E5%86%B3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">AI 情感聊天机器人工作之旅 —— 与复读机问题的相遇与别离</div></div></a></div><div class="next-post pull-right"><a href="/%E5%B1%82%E5%89%AA%E6%9E%9D%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%AB%81%E6%8E%A5%E7%9A%84%E2%80%9C%E5%8F%8C%E7%94%9F%E8%8A%B1%E2%80%9D/" title="论文阅读：The Unreasonable Ineffectiveness of the Deeper Layers 层剪枝与模型嫁接的“双生花”"><img class="cover" src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/The%20Unreasonable%20Ineffectiveness%20of%20the%20Deeper%20Layers/Figure%201.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">论文阅读：The Unreasonable Ineffectiveness of the Deeper Layers 层剪枝与模型嫁接的“双生花”</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/%E5%B1%82%E5%89%AA%E6%9E%9D%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%AB%81%E6%8E%A5%E7%9A%84%E2%80%9C%E5%8F%8C%E7%94%9F%E8%8A%B1%E2%80%9D/" title="论文阅读：The Unreasonable Ineffectiveness of the Deeper Layers 层剪枝与模型嫁接的“双生花”"><img class="cover" src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/The%20Unreasonable%20Ineffectiveness%20of%20the%20Deeper%20Layers/Figure%201.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-10</div><div class="title">论文阅读：The Unreasonable Ineffectiveness of the Deeper Layers 层剪枝与模型嫁接的“双生花”</div></div></a></div><div><a href="/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9AA-Survey-on-Data-Selection-for-LLM-Instruction-Tuning/" title="论文阅读：A Survey on Data Selection for LLM Instruction Tuning"><img class="cover" src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/A%20Survey%20on%20Data%20Selection%20for%20LLM%20Instruction%20Tuning/Figure%201.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-08</div><div class="title">论文阅读：A Survey on Data Selection for LLM Instruction Tuning</div></div></a></div><div><a href="/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9AAlbert%EF%BC%9AA-Lite-Bert-for-self-supervised-learning-of-language-representations/" title="论文阅读：Albert：A Lite Bert for self-supervised learning of language representations"><img class="cover" src="https://pic1.zhimg.com/80/v2-8ea109ed6f3a3781951402a6cf7cc586_720w.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-28</div><div class="title">论文阅读：Albert：A Lite Bert for self-supervised learning of language representations</div></div></a></div><div><a href="/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ABag-of-Tricks-for-Efficient-Text-Classification/" title="论文阅读：Bag of Tricks for Efficient Text Classification"><img class="cover" src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/Bag%20of%20Tricks%20for%20Efficient%20Text%20Classification/FIgure%201.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-22</div><div class="title">论文阅读：Bag of Tricks for Efficient Text Classification</div></div></a></div><div><a href="/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ADeeBERT%EF%BC%9ADynamic-Early-Exiting-for-Accelerating-BERT-Inference/" title="论文阅读：DeeBERT：Dynamic Early Exiting for Accelerating BERT Inference"><img class="cover" src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/DeeBERT%20Dynamic%20Early%20Exiting%20for%20Accelerating%20BERT%20Inference/Figure%201.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-17</div><div class="title">论文阅读：DeeBERT：Dynamic Early Exiting for Accelerating BERT Inference</div></div></a></div><div><a href="/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9AEDA%EF%BC%9AEasy-Data-Augmentation-Techniques-for-Boosting-Performance-on-Text-Classification-Tasks/" title="论文阅读：EDA：Easy Data Augmentation Techniques for Boosting Performance on Text Classification Tasks"><img class="cover" src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/EDA%20Easy%20Data%20Augmentation%20Techniques%20for%20Boosting%20Performance%20on%20Text%20Classification%20Tasks/EDA%20Figure1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-03</div><div class="title">论文阅读：EDA：Easy Data Augmentation Techniques for Boosting Performance on Text Classification Tasks</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">clvsit</div><div class="author-info__description">人生不是戏剧，而我亦非主角</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">63</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/clvsit"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/clvsit" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">知乎和 CSDN 同名 clvsit，目前在将本地的笔记逐步迁移到这，所以会看到过去日期的文章不断增多</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%EF%BC%9ADIVERSEEVOL"><span class="toc-number">1.</span> <span class="toc-text">方法：DIVERSEEVOL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E6%8C%87%E4%BB%A4%E6%95%B0%E6%8D%AE%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.</span> <span class="toc-text">迭代指令数据选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E7%AE%97%E6%B3%95%EF%BC%9AK-Center-Sampling"><span class="toc-number">1.2.</span> <span class="toc-text">选择算法：K-Center-Sampling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">Python 实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E9%99%90%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">总结与限制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95-A%EF%BC%9AGPT-4-Judge-%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.</span> <span class="toc-text">附录 A：GPT-4 Judge 模板</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/AI-%E6%83%85%E6%84%9F%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA%E4%B9%8B%E6%97%85%E2%80%94%E2%80%94%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87%E6%94%B6%E9%9B%86/" title="AI-情感聊天机器人之旅——相关论文收集">AI-情感聊天机器人之旅——相关论文收集</a><time datetime="2024-06-20T13:15:26.000Z" title="发表于 2024-06-20 21:15:26">2024-06-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/PyramidKV/" title="PyramidKV">PyramidKV</a><time datetime="2024-06-14T12:27:21.000Z" title="发表于 2024-06-14 20:27:21">2024-06-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Long-Context-%E8%B0%83%E7%A0%94/" title="Long Context 调研">Long Context 调研</a><time datetime="2024-06-10T14:43:57.000Z" title="发表于 2024-06-10 22:43:57">2024-06-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/vocab-size-%E7%A0%94%E7%A9%B6/" title="vocab size 调研">vocab size 调研</a><time datetime="2024-05-31T15:47:07.000Z" title="发表于 2024-05-31 23:47:07">2024-05-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ARCoT-Detecting-and-Rectifying-Factual-Inconsistency-in-Reasoning-by-Reversing-Chain-of-Thought/" title="论文阅读：RCoT Detecting and Rectifying Factual Inconsistency in Reasoning by Reversing Chain-of-Thought"><img src="https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/RCoT%EF%BC%9ADetecting%20and%20Rectifying%20Factual%20Inconsistency%20in%20Reasoning%20by%20Reversing%20Chain-of-Thought/Figure%204.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="论文阅读：RCoT Detecting and Rectifying Factual Inconsistency in Reasoning by Reversing Chain-of-Thought"/></a><div class="content"><a class="title" href="/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ARCoT-Detecting-and-Rectifying-Factual-Inconsistency-in-Reasoning-by-Reversing-Chain-of-Thought/" title="论文阅读：RCoT Detecting and Rectifying Factual Inconsistency in Reasoning by Reversing Chain-of-Thought">论文阅读：RCoT Detecting and Rectifying Factual Inconsistency in Reasoning by Reversing Chain-of-Thought</a><time datetime="2024-05-17T13:37:04.000Z" title="发表于 2024-05-17 21:37:04">2024-05-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://markdown-picture-clvsit.oss-cn-hangzhou.aliyuncs.com/nlp/paper/Self-Evolved%20Diverse%20Data%20Sampling%20for%20Efficient%20Instruction%20Tuning/Figure%201.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By clvsit</div><div class="footer_custom_text">城南芳草城北溪，池塘烟柳归鸟栖。忽听窗外风吹雨，一梦花落月近西。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>